{"ast":null,"code":"import ml5 from 'ml5';\n\nconst sketch = p => {\n  let video;\n  let poseNet;\n  let count = 0;\n  let countCanvas;\n  let should_count = true;\n  let noseX = 0;\n  let noseY = 0;\n  let lShoulderX = 0;\n  let lShoulderY = 0;\n  let rShoulderX = 0;\n  let rShoulderY = 0;\n  let lElbowX = 0;\n  let lElbowY = 0;\n  let rElbowX = 0;\n  let rElbowY = 0;\n  let lWristX = 0;\n  let lWristY = 0;\n  let rWristX = 0;\n  let rWristY = 0;\n  let lHipX = 0;\n  let lHipY = 0;\n  let rHipX = 0;\n  let rHipY = 0;\n  let lKneeX = 0;\n  let lKneeY = 0;\n  let rKneeX = 0;\n  let rKneeY = 0;\n  let lAnkleX = 0;\n  let lAnkleY = 0;\n  let rAnkleX = 0;\n  let rAnkleY = 0; // text(s, x, y, w, h)\n  // 最初の1回だけ実装される処理\n\n  p.setup = () => {\n    p.createCanvas(p.windowWidth, p.windowHeight);\n    countCanvas = p.createGraphics(p.windowWidth, p.windowHeight * 0.1);\n    video = p.createCapture(p.VIDEO);\n    video.size(p.windowWidth, p.windowHeight);\n    video.hide(); // 映像を一つにする\n\n    poseNet = ml5.poseNet(video, p.modelReady);\n    poseNet.on('pose', p.gotPoses); // ポーズが検出された時に結果を返すイベント\n  };\n\n  p.windowResized = () => {\n    p.resizeCanvas(p.windowWidth, p.windowHeight);\n  };\n\n  p.gotPoses = poses => {\n    // console.log(poses)\n    if (poses.length > 0) {\n      let nX = poses[0].pose.keypoints[0].position.x;\n      let nY = poses[0].pose.keypoints[0].position.y;\n      let leftShoulderX = poses[0].pose.keypoints[5].position.x;\n      let leftShoulderY = poses[0].pose.keypoints[5].position.y;\n      let rightShoulderX = poses[0].pose.keypoints[6].position.x;\n      let rightShoulderY = poses[0].pose.keypoints[6].position.y;\n      let leftElbowX = poses[0].pose.keypoints[7].position.x;\n      let leftElbowY = poses[0].pose.keypoints[7].position.y;\n      let rightElbowX = poses[0].pose.keypoints[8].position.x;\n      let rightElbowY = poses[0].pose.keypoints[8].position.y;\n      let leftWristX = poses[0].pose.keypoints[9].position.x;\n      let leftWristY = poses[0].pose.keypoints[9].position.y;\n      let rightWristX = poses[0].pose.keypoints[10].position.x;\n      let rightWristY = poses[0].pose.keypoints[10].position.y;\n      let leftHipX = poses[0].pose.keypoints[11].position.x;\n      let leftHipY = poses[0].pose.keypoints[11].position.y;\n      let rightHipX = poses[0].pose.keypoints[12].position.x;\n      let rightHipY = poses[0].pose.keypoints[12].position.y;\n      let leftKneeX = poses[0].pose.keypoints[13].position.x;\n      let leftKneeY = poses[0].pose.keypoints[13].position.y;\n      let rightKneeX = poses[0].pose.keypoints[14].position.x;\n      let rightKneeY = poses[0].pose.keypoints[14].position.y;\n      let leftAnkleX = poses[0].pose.keypoints[15].position.x;\n      let leftAnkleY = poses[0].pose.keypoints[15].position.y;\n      let rightAnkleX = poses[0].pose.keypoints[16].position.x;\n      let rightAnkleY = poses[0].pose.keypoints[16].position.y;\n      noseX = p.lerp(noseX, nX, 0.5);\n      noseY = p.lerp(noseY, nY, 0.5);\n      lShoulderX = p.lerp(lShoulderX, leftShoulderX, 0.5);\n      lShoulderY = p.lerp(lShoulderY, leftShoulderY, 0.5);\n      rShoulderX = p.lerp(rShoulderX, rightShoulderX, 0.5);\n      rShoulderY = p.lerp(rShoulderY, rightShoulderY, 0.5);\n      lElbowX = p.lerp(lElbowX, leftElbowX, 0.5);\n      lElbowY = p.lerp(lElbowY, leftElbowY, 0.5);\n      rElbowX = p.lerp(rElbowX, rightElbowX, 0.5);\n      rElbowY = p.lerp(rElbowY, rightElbowY, 0.5);\n      lWristX = p.lerp(lWristX, leftWristX, 0.5);\n      lWristY = p.lerp(lWristY, leftWristY, 0.5);\n      rWristX = p.lerp(rWristX, rightWristX, 0.5);\n      rWristY = p.lerp(rWristY, rightWristY, 0.5);\n      lHipX = p.lerp(lHipX, leftHipX, 0.5);\n      lHipY = p.lerp(lHipY, leftHipY, 0.5);\n      rHipX = p.lerp(rHipX, rightHipX, 0.5);\n      rHipY = p.lerp(rHipY, rightHipY, 0.5);\n      lKneeX = p.lerp(lKneeX, leftKneeX, 0.5);\n      lKneeY = p.lerp(lKneeY, leftKneeY, 0.5);\n      rKneeX = p.lerp(rKneeX, rightKneeX, 0.5);\n      rKneeY = p.lerp(rKneeY, rightKneeY, 0.5);\n      lAnkleX = p.lerp(lAnkleX, leftAnkleX, 0.5);\n      lAnkleY = p.lerp(lAnkleY, leftAnkleY, 0.5);\n      rAnkleX = p.lerp(rAnkleX, rightAnkleX, 0.5);\n      rAnkleY = p.lerp(rAnkleY, rightAnkleY, 0.5);\n      console.log(nY); // 座標\n      // (lHipX, lHipY)\n      // (lKneeX, lKneeY)\n      // (lAnkleX, lAnkleY)\n\n      plopt[0].x = leftHipX;\n      plopt[0].y = leftHipY;\n      plopt[1].x = leftKneeX;\n      plopt[1].y = leftKneeX;\n      plopt[2].x = leftAnkleX;\n      plopt[2].y = leftAnkleY;\n      var ba = new Array(2);\n      ba[0] = plot[0].x - plot[1].x;\n      ba[1] = plot[0].y - plot[1].y;\n      var bc = new Array(2);\n      bc[0] = plot[2].x - plot[1].x;\n      bc[1] = plot[2].y - plot[1].y;\n      var babc = ba[0] * bc[0] + ba[1] * bc[1];\n      var ban = ba[0] * ba[0] + ba[1] * ba[1];\n      var bcn = bc[0] * bc[0] + bc[1] * bc[1];\n      var radian = Math.acos(babc / Math.sqrt(ban * bcn));\n      var angle = radian * 180 / Math.PI; // 結果（ラジアンから角度に変換）\n\n      if (nY <= 350) {\n        should_count = true;\n      } else if (nY >= 370 && should_count) {\n        count += 1;\n        should_count = false;\n      }\n    }\n  };\n\n  p.modelReady = () => {// console.log('model ready')\n  }; // setup後に繰り返し実行される処理（フレーム単位）\n\n\n  p.draw = () => {\n    p.background(220); // カメラからの映像は一旦getしてイメージとして扱う方が軽量\n\n    let img = video.get();\n    p.image(img, 0, 0, p.width, p.height);\n    p.fill(245, 222, 179);\n    p.ellipse(noseX, noseY, 20);\n    p.ellipse(lShoulderX, lShoulderY, 20);\n    p.ellipse(rShoulderX, rShoulderY, 20);\n    p.ellipse(lElbowX, lElbowY, 20);\n    p.ellipse(rElbowX, rElbowY, 20);\n    p.ellipse(lWristX, lWristY, 20);\n    p.ellipse(rWristX, rWristY, 20);\n    p.ellipse(lHipX, lHipY, 20);\n    p.ellipse(rHipX, rHipY, 20);\n    p.ellipse(lKneeX, lKneeY, 20);\n    p.ellipse(rKneeX, rKneeY, 20);\n    p.ellipse(lAnkleX, lAnkleY, 20);\n    p.ellipse(rAnkleX, rAnkleY, 20);\n    p.strokeWeight(5);\n    p.stroke(255, 127, 80);\n    p.line(lShoulderX, lShoulderY, rShoulderX, rShoulderY);\n    p.line(lShoulderX, lShoulderY, lElbowX, lElbowY);\n    p.line(lElbowX, lElbowY, lWristX, lWristY);\n    p.line(rShoulderX, rShoulderY, rElbowX, rElbowY);\n    p.line(rElbowX, rElbowY, rWristX, rWristY);\n    p.line(lShoulderX, lShoulderY, lHipX, lHipY);\n    p.line(lHipX, lHipY, lKneeX, lKneeY);\n    p.line(lKneeX, lKneeY, lAnkleX, lAnkleY);\n    p.line(rShoulderX, rShoulderY, rHipX, rHipY);\n    p.line(rHipX, rHipY, rKneeX, rKneeY);\n    p.line(rKneeX, rKneeY, rAnkleX, rAnkleY);\n    p.line(lHipX, lHipY, rHipX, rHipY);\n    p.line(0, 350, p.width, 350); // header\n\n    countCanvas.background(0);\n    countCanvas.noStroke();\n    p.image(countCanvas, 0, 0); // count\n\n    p.fill(255, 127, 80);\n    p.stroke(255, 127, 80);\n    p.text('count : ' + count, 50, 60);\n    p.textSize(60);\n  };\n};\n\nexport default sketch;","map":{"version":3,"sources":["/Users/idetaisei/dev/fitness_counter/client/src/sketches/Squat.js"],"names":["ml5","sketch","p","video","poseNet","count","countCanvas","should_count","noseX","noseY","lShoulderX","lShoulderY","rShoulderX","rShoulderY","lElbowX","lElbowY","rElbowX","rElbowY","lWristX","lWristY","rWristX","rWristY","lHipX","lHipY","rHipX","rHipY","lKneeX","lKneeY","rKneeX","rKneeY","lAnkleX","lAnkleY","rAnkleX","rAnkleY","setup","createCanvas","windowWidth","windowHeight","createGraphics","createCapture","VIDEO","size","hide","modelReady","on","gotPoses","windowResized","resizeCanvas","poses","length","nX","pose","keypoints","position","x","nY","y","leftShoulderX","leftShoulderY","rightShoulderX","rightShoulderY","leftElbowX","leftElbowY","rightElbowX","rightElbowY","leftWristX","leftWristY","rightWristX","rightWristY","leftHipX","leftHipY","rightHipX","rightHipY","leftKneeX","leftKneeY","rightKneeX","rightKneeY","leftAnkleX","leftAnkleY","rightAnkleX","rightAnkleY","lerp","console","log","plopt","ba","Array","plot","bc","babc","ban","bcn","radian","Math","acos","sqrt","angle","PI","draw","background","img","get","image","width","height","fill","ellipse","strokeWeight","stroke","line","noStroke","text","textSize"],"mappings":"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","sourcesContent":["import ml5 from 'ml5'\n\nconst sketch = (p) => {\n  let video\n  let poseNet\n  let count = 0\n  let countCanvas\n  let should_count = true\n  let noseX = 0\n  let noseY = 0\n  let lShoulderX = 0\n  let lShoulderY = 0\n  let rShoulderX = 0\n  let rShoulderY = 0\n  let lElbowX = 0\n  let lElbowY = 0\n  let rElbowX = 0\n  let rElbowY = 0\n  let lWristX = 0\n  let lWristY = 0\n  let rWristX = 0\n  let rWristY = 0\n  let lHipX = 0\n  let lHipY = 0\n  let rHipX = 0\n  let rHipY = 0\n  let lKneeX = 0\n  let lKneeY = 0\n  let rKneeX = 0\n  let rKneeY = 0\n  let lAnkleX = 0\n  let lAnkleY = 0\n  let rAnkleX = 0\n  let rAnkleY = 0\n\n  // text(s, x, y, w, h)\n\n  // 最初の1回だけ実装される処理\n  p.setup = () => {\n    p.createCanvas(p.windowWidth, p.windowHeight)\n    countCanvas = p.createGraphics(p.windowWidth, p.windowHeight * 0.1)\n    video = p.createCapture(p.VIDEO)\n    video.size(p.windowWidth, p.windowHeight)\n    video.hide() // 映像を一つにする\n    poseNet = ml5.poseNet(video, p.modelReady)\n    poseNet.on('pose', p.gotPoses) // ポーズが検出された時に結果を返すイベント\n  }\n\n  p.windowResized = () => {\n    p.resizeCanvas(p.windowWidth, p.windowHeight)\n  }\n\n  p.gotPoses = (poses) => {\n    // console.log(poses)\n    if (poses.length > 0) {\n      let nX = poses[0].pose.keypoints[0].position.x\n      let nY = poses[0].pose.keypoints[0].position.y\n      let leftShoulderX = poses[0].pose.keypoints[5].position.x\n      let leftShoulderY = poses[0].pose.keypoints[5].position.y\n      let rightShoulderX = poses[0].pose.keypoints[6].position.x\n      let rightShoulderY = poses[0].pose.keypoints[6].position.y\n      let leftElbowX = poses[0].pose.keypoints[7].position.x\n      let leftElbowY = poses[0].pose.keypoints[7].position.y\n      let rightElbowX = poses[0].pose.keypoints[8].position.x\n      let rightElbowY = poses[0].pose.keypoints[8].position.y\n      let leftWristX = poses[0].pose.keypoints[9].position.x\n      let leftWristY = poses[0].pose.keypoints[9].position.y\n      let rightWristX = poses[0].pose.keypoints[10].position.x\n      let rightWristY = poses[0].pose.keypoints[10].position.y\n      let leftHipX = poses[0].pose.keypoints[11].position.x\n      let leftHipY = poses[0].pose.keypoints[11].position.y\n      let rightHipX = poses[0].pose.keypoints[12].position.x\n      let rightHipY = poses[0].pose.keypoints[12].position.y\n      let leftKneeX = poses[0].pose.keypoints[13].position.x\n      let leftKneeY = poses[0].pose.keypoints[13].position.y\n      let rightKneeX = poses[0].pose.keypoints[14].position.x\n      let rightKneeY = poses[0].pose.keypoints[14].position.y\n      let leftAnkleX = poses[0].pose.keypoints[15].position.x\n      let leftAnkleY = poses[0].pose.keypoints[15].position.y\n      let rightAnkleX = poses[0].pose.keypoints[16].position.x\n      let rightAnkleY = poses[0].pose.keypoints[16].position.y\n\n      noseX = p.lerp(noseX, nX, 0.5)\n      noseY = p.lerp(noseY, nY, 0.5)\n      lShoulderX = p.lerp(lShoulderX, leftShoulderX, 0.5)\n      lShoulderY = p.lerp(lShoulderY, leftShoulderY, 0.5)\n      rShoulderX = p.lerp(rShoulderX, rightShoulderX, 0.5)\n      rShoulderY = p.lerp(rShoulderY, rightShoulderY, 0.5)\n      lElbowX = p.lerp(lElbowX, leftElbowX, 0.5)\n      lElbowY = p.lerp(lElbowY, leftElbowY, 0.5)\n      rElbowX = p.lerp(rElbowX, rightElbowX, 0.5)\n      rElbowY = p.lerp(rElbowY, rightElbowY, 0.5)\n      lWristX = p.lerp(lWristX, leftWristX, 0.5)\n      lWristY = p.lerp(lWristY, leftWristY, 0.5)\n      rWristX = p.lerp(rWristX, rightWristX, 0.5)\n      rWristY = p.lerp(rWristY, rightWristY, 0.5)\n      lHipX = p.lerp(lHipX, leftHipX, 0.5)\n      lHipY = p.lerp(lHipY, leftHipY, 0.5)\n      rHipX = p.lerp(rHipX, rightHipX, 0.5)\n      rHipY = p.lerp(rHipY, rightHipY, 0.5)\n      lKneeX = p.lerp(lKneeX, leftKneeX, 0.5)\n      lKneeY = p.lerp(lKneeY, leftKneeY, 0.5)\n      rKneeX = p.lerp(rKneeX, rightKneeX, 0.5)\n      rKneeY = p.lerp(rKneeY, rightKneeY, 0.5)\n      lAnkleX = p.lerp(lAnkleX, leftAnkleX, 0.5)\n      lAnkleY = p.lerp(lAnkleY, leftAnkleY, 0.5)\n      rAnkleX = p.lerp(rAnkleX, rightAnkleX, 0.5)\n      rAnkleY = p.lerp(rAnkleY, rightAnkleY, 0.5)\n\n      console.log(nY)\n      // 座標\n      // (lHipX, lHipY)\n      // (lKneeX, lKneeY)\n      // (lAnkleX, lAnkleY)\n      plopt[0].x = leftHipX\n      plopt[0].y = leftHipY\n      plopt[1].x = leftKneeX\n      plopt[1].y = leftKneeX\n      plopt[2].x = leftAnkleX\n      plopt[2].y = leftAnkleY\n\n      var ba = new Array(2)\n      ba[0] = plot[0].x - plot[1].x\n      ba[1] = plot[0].y - plot[1].y\n      var bc = new Array(2)\n      bc[0] = plot[2].x - plot[1].x\n      bc[1] = plot[2].y - plot[1].y\n\n      var babc = ba[0] * bc[0] + ba[1] * bc[1]\n      var ban = ba[0] * ba[0] + ba[1] * ba[1]\n      var bcn = bc[0] * bc[0] + bc[1] * bc[1]\n      var radian = Math.acos(babc / Math.sqrt(ban * bcn))\n      var angle = (radian * 180) / Math.PI // 結果（ラジアンから角度に変換）\n\n      if (nY <= 350) {\n        should_count = true\n      } else if (nY >= 370 && should_count) {\n        count += 1\n        should_count = false\n      }\n    }\n  }\n\n  p.modelReady = () => {\n    // console.log('model ready')\n  }\n\n  // setup後に繰り返し実行される処理（フレーム単位）\n  p.draw = () => {\n    p.background(220)\n\n    // カメラからの映像は一旦getしてイメージとして扱う方が軽量\n    let img = video.get()\n    p.image(img, 0, 0, p.width, p.height)\n\n    p.fill(245, 222, 179)\n    p.ellipse(noseX, noseY, 20)\n    p.ellipse(lShoulderX, lShoulderY, 20)\n    p.ellipse(rShoulderX, rShoulderY, 20)\n    p.ellipse(lElbowX, lElbowY, 20)\n    p.ellipse(rElbowX, rElbowY, 20)\n    p.ellipse(lWristX, lWristY, 20)\n    p.ellipse(rWristX, rWristY, 20)\n    p.ellipse(lHipX, lHipY, 20)\n    p.ellipse(rHipX, rHipY, 20)\n    p.ellipse(lKneeX, lKneeY, 20)\n    p.ellipse(rKneeX, rKneeY, 20)\n    p.ellipse(lAnkleX, lAnkleY, 20)\n    p.ellipse(rAnkleX, rAnkleY, 20)\n\n    p.strokeWeight(5)\n    p.stroke(255, 127, 80)\n    p.line(lShoulderX, lShoulderY, rShoulderX, rShoulderY)\n    p.line(lShoulderX, lShoulderY, lElbowX, lElbowY)\n    p.line(lElbowX, lElbowY, lWristX, lWristY)\n    p.line(rShoulderX, rShoulderY, rElbowX, rElbowY)\n    p.line(rElbowX, rElbowY, rWristX, rWristY)\n    p.line(lShoulderX, lShoulderY, lHipX, lHipY)\n    p.line(lHipX, lHipY, lKneeX, lKneeY)\n    p.line(lKneeX, lKneeY, lAnkleX, lAnkleY)\n    p.line(rShoulderX, rShoulderY, rHipX, rHipY)\n    p.line(rHipX, rHipY, rKneeX, rKneeY)\n    p.line(rKneeX, rKneeY, rAnkleX, rAnkleY)\n    p.line(lHipX, lHipY, rHipX, rHipY)\n\n    p.line(0, 350, p.width, 350)\n\n    // header\n    countCanvas.background(0)\n    countCanvas.noStroke()\n    p.image(countCanvas, 0, 0)\n\n    // count\n    p.fill(255, 127, 80)\n    p.stroke(255, 127, 80)\n    p.text('count : ' + count, 50, 60)\n    p.textSize(60)\n  }\n}\n\nexport default sketch\n"]},"metadata":{},"sourceType":"module"}