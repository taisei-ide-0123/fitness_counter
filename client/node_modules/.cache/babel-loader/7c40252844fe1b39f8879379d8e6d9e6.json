{"ast":null,"code":"import ml5 from'ml5';var PushUp=function PushUp(p){var video;var poseNet;var count=0;var countCanvas;var should_count=true;var noseX=0;var noseY=0;var lShoulderX=0;var lShoulderY=0;var rShoulderX=0;var rShoulderY=0;var lElbowX=0;var lElbowY=0;var rElbowX=0;var rElbowY=0;var lWristX=0;var lWristY=0;var rWristX=0;var rWristY=0;var lHipX=0;var lHipY=0;var rHipX=0;var rHipY=0;var lKneeX=0;var lKneeY=0;var rKneeX=0;var rKneeY=0;var lAnkleX=0;var lAnkleY=0;var rAnkleX=0;var rAnkleY=0;// text(s, x, y, w, h)\n// 最初の1回だけ実装される処理\np.setup=function(){p.createCanvas(p.windowWidth,p.windowHeight);countCanvas=p.createGraphics(p.windowWidth,p.windowHeight*0.1);video=p.createCapture(p.VIDEO);video.size(p.windowWidth,p.windowHeight);video.hide();// 映像を一つにする\nposeNet=ml5.poseNet(video,p.modelReady);poseNet.on('pose',p.gotPoses);// ポーズが検出された時に結果を返すイベント\n};p.windowResized=function(){p.resizeCanvas(p.windowWidth,p.windowHeight);};p.gotPoses=function(poses){// console.log(poses)\nif(poses.length>0){var nX=poses[0].pose.keypoints[0].position.x;var nY=poses[0].pose.keypoints[0].position.y;var leftShoulderX=poses[0].pose.keypoints[5].position.x;var leftShoulderY=poses[0].pose.keypoints[5].position.y;var rightShoulderX=poses[0].pose.keypoints[6].position.x;var rightShoulderY=poses[0].pose.keypoints[6].position.y;var leftElbowX=poses[0].pose.keypoints[7].position.x;var leftElbowY=poses[0].pose.keypoints[7].position.y;var rightElbowX=poses[0].pose.keypoints[8].position.x;var rightElbowY=poses[0].pose.keypoints[8].position.y;var leftWristX=poses[0].pose.keypoints[9].position.x;var leftWristY=poses[0].pose.keypoints[9].position.y;var rightWristX=poses[0].pose.keypoints[10].position.x;var rightWristY=poses[0].pose.keypoints[10].position.y;var leftHipX=poses[0].pose.keypoints[11].position.x;var leftHipY=poses[0].pose.keypoints[11].position.y;var rightHipX=poses[0].pose.keypoints[12].position.x;var rightHipY=poses[0].pose.keypoints[12].position.y;var leftKneeX=poses[0].pose.keypoints[13].position.x;var leftKneeY=poses[0].pose.keypoints[13].position.y;var rightKneeX=poses[0].pose.keypoints[14].position.x;var rightKneeY=poses[0].pose.keypoints[14].position.y;var leftAnkleX=poses[0].pose.keypoints[15].position.x;var leftAnkleY=poses[0].pose.keypoints[15].position.y;var rightAnkleX=poses[0].pose.keypoints[16].position.x;var rightAnkleY=poses[0].pose.keypoints[16].position.y;noseX=p.lerp(noseX,nX,0.5);noseY=p.lerp(noseY,nY,0.5);lShoulderX=p.lerp(lShoulderX,leftShoulderX,0.5);lShoulderY=p.lerp(lShoulderY,leftShoulderY,0.5);rShoulderX=p.lerp(rShoulderX,rightShoulderX,0.5);rShoulderY=p.lerp(rShoulderY,rightShoulderY,0.5);lElbowX=p.lerp(lElbowX,leftElbowX,0.5);lElbowY=p.lerp(lElbowY,leftElbowY,0.5);rElbowX=p.lerp(rElbowX,rightElbowX,0.5);rElbowY=p.lerp(rElbowY,rightElbowY,0.5);lWristX=p.lerp(lWristX,leftWristX,0.5);lWristY=p.lerp(lWristY,leftWristY,0.5);rWristX=p.lerp(rWristX,rightWristX,0.5);rWristY=p.lerp(rWristY,rightWristY,0.5);lHipX=p.lerp(lHipX,leftHipX,0.5);lHipY=p.lerp(lHipY,leftHipY,0.5);rHipX=p.lerp(rHipX,rightHipX,0.5);rHipY=p.lerp(rHipY,rightHipY,0.5);lKneeX=p.lerp(lKneeX,leftKneeX,0.5);lKneeY=p.lerp(lKneeY,leftKneeY,0.5);rKneeX=p.lerp(rKneeX,rightKneeX,0.5);rKneeY=p.lerp(rKneeY,rightKneeY,0.5);lAnkleX=p.lerp(lAnkleX,leftAnkleX,0.5);lAnkleY=p.lerp(lAnkleY,leftAnkleY,0.5);rAnkleX=p.lerp(rAnkleX,rightAnkleX,0.5);rAnkleY=p.lerp(rAnkleY,rightAnkleY,0.5);// 座標\n// (leftShoulderX, leftShoulderY)\n// (leftElbowX, leftElbowY)\n// (leftWristX, leftWristY)\nvar lSE=new Array(2);lSE[0]=leftShoulderX-leftElbowX;lSE[1]=leftShoulderY-leftShoulderY;var lWE=new Array(2);lWE[0]=leftWristX-leftElbowX;lWE[1]=leftWristY-leftElbowY;var lSEWE=lSE[0]*lWE[0]+lSE[1]*lWE[1];var lSEn=lSE[0]*lSE[0]+lSE[1]*lSE[1];var lWEn=lWE[0]*lWE[0]+lWE[1]*lWE[1];var radian=Math.acos(lSEWE/Math.sqrt(lSEn*lWEn));var angle=radian*180/Math.PI;// 結果（ラジアンから角度に変換）\nconsole.log(angle);if(angle>=100){should_count=true;}else if(angle<=70&&should_count){count+=1;should_count=false;}}};p.modelReady=function(){// console.log('model ready')\n};// setup後に繰り返し実行される処理（フレーム単位）\np.draw=function(){p.background(220);// カメラからの映像は一旦getしてイメージとして扱う方が軽量\nvar img=video.get();p.image(img,0,0,p.width,p.height);p.fill(245,222,179);p.ellipse(noseX,noseY,20);p.ellipse(lShoulderX,lShoulderY,20);p.ellipse(rShoulderX,rShoulderY,20);p.ellipse(lElbowX,lElbowY,20);p.ellipse(rElbowX,rElbowY,20);p.ellipse(lWristX,lWristY,20);p.ellipse(rWristX,rWristY,20);p.ellipse(lHipX,lHipY,20);p.ellipse(rHipX,rHipY,20);p.ellipse(lKneeX,lKneeY,20);p.ellipse(rKneeX,rKneeY,20);p.ellipse(lAnkleX,lAnkleY,20);p.ellipse(rAnkleX,rAnkleY,20);p.strokeWeight(5);p.stroke(255,127,80);p.line(lShoulderX,lShoulderY,rShoulderX,rShoulderY);p.line(lShoulderX,lShoulderY,lElbowX,lElbowY);p.line(lElbowX,lElbowY,lWristX,lWristY);p.line(rShoulderX,rShoulderY,rElbowX,rElbowY);p.line(rElbowX,rElbowY,rWristX,rWristY);p.line(lShoulderX,lShoulderY,lHipX,lHipY);p.line(lHipX,lHipY,lKneeX,lKneeY);p.line(lKneeX,lKneeY,lAnkleX,lAnkleY);p.line(rShoulderX,rShoulderY,rHipX,rHipY);p.line(rHipX,rHipY,rKneeX,rKneeY);p.line(rKneeX,rKneeY,rAnkleX,rAnkleY);p.line(lHipX,lHipY,rHipX,rHipY);// header\ncountCanvas.background(0,0,0,0.8);countCanvas.noStroke();p.image(countCanvas,0,0,400);// count\np.fill(255,127,80);p.text('count : '+count,50,60);p.textSize(60);};};export default PushUp;","map":{"version":3,"sources":["/Users/idetaisei/fitness_counter/client/src/sketches/PushUp.js"],"names":["ml5","PushUp","p","video","poseNet","count","countCanvas","should_count","noseX","noseY","lShoulderX","lShoulderY","rShoulderX","rShoulderY","lElbowX","lElbowY","rElbowX","rElbowY","lWristX","lWristY","rWristX","rWristY","lHipX","lHipY","rHipX","rHipY","lKneeX","lKneeY","rKneeX","rKneeY","lAnkleX","lAnkleY","rAnkleX","rAnkleY","setup","createCanvas","windowWidth","windowHeight","createGraphics","createCapture","VIDEO","size","hide","modelReady","on","gotPoses","windowResized","resizeCanvas","poses","length","nX","pose","keypoints","position","x","nY","y","leftShoulderX","leftShoulderY","rightShoulderX","rightShoulderY","leftElbowX","leftElbowY","rightElbowX","rightElbowY","leftWristX","leftWristY","rightWristX","rightWristY","leftHipX","leftHipY","rightHipX","rightHipY","leftKneeX","leftKneeY","rightKneeX","rightKneeY","leftAnkleX","leftAnkleY","rightAnkleX","rightAnkleY","lerp","lSE","Array","lWE","lSEWE","lSEn","lWEn","radian","Math","acos","sqrt","angle","PI","console","log","draw","background","img","get","image","width","height","fill","ellipse","strokeWeight","stroke","line","noStroke","text","textSize"],"mappings":"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","sourcesContent":["import ml5 from 'ml5'\n\nconst PushUp = (p) => {\n  let video\n  let poseNet\n  let count = 0\n  let countCanvas\n  let should_count = true\n  let noseX = 0\n  let noseY = 0\n  let lShoulderX = 0\n  let lShoulderY = 0\n  let rShoulderX = 0\n  let rShoulderY = 0\n  let lElbowX = 0\n  let lElbowY = 0\n  let rElbowX = 0\n  let rElbowY = 0\n  let lWristX = 0\n  let lWristY = 0\n  let rWristX = 0\n  let rWristY = 0\n  let lHipX = 0\n  let lHipY = 0\n  let rHipX = 0\n  let rHipY = 0\n  let lKneeX = 0\n  let lKneeY = 0\n  let rKneeX = 0\n  let rKneeY = 0\n  let lAnkleX = 0\n  let lAnkleY = 0\n  let rAnkleX = 0\n  let rAnkleY = 0\n\n  // text(s, x, y, w, h)\n\n  // 最初の1回だけ実装される処理\n  p.setup = () => {\n    p.createCanvas(p.windowWidth, p.windowHeight)\n    countCanvas = p.createGraphics(p.windowWidth, p.windowHeight * 0.1)\n    video = p.createCapture(p.VIDEO)\n    video.size(p.windowWidth, p.windowHeight)\n    video.hide() // 映像を一つにする\n    poseNet = ml5.poseNet(video, p.modelReady)\n    poseNet.on('pose', p.gotPoses) // ポーズが検出された時に結果を返すイベント\n  }\n\n  p.windowResized = () => {\n    p.resizeCanvas(p.windowWidth, p.windowHeight)\n  }\n\n  p.gotPoses = (poses) => {\n    // console.log(poses)\n    if (poses.length > 0) {\n      let nX = poses[0].pose.keypoints[0].position.x\n      let nY = poses[0].pose.keypoints[0].position.y\n      let leftShoulderX = poses[0].pose.keypoints[5].position.x\n      let leftShoulderY = poses[0].pose.keypoints[5].position.y\n      let rightShoulderX = poses[0].pose.keypoints[6].position.x\n      let rightShoulderY = poses[0].pose.keypoints[6].position.y\n      let leftElbowX = poses[0].pose.keypoints[7].position.x\n      let leftElbowY = poses[0].pose.keypoints[7].position.y\n      let rightElbowX = poses[0].pose.keypoints[8].position.x\n      let rightElbowY = poses[0].pose.keypoints[8].position.y\n      let leftWristX = poses[0].pose.keypoints[9].position.x\n      let leftWristY = poses[0].pose.keypoints[9].position.y\n      let rightWristX = poses[0].pose.keypoints[10].position.x\n      let rightWristY = poses[0].pose.keypoints[10].position.y\n      let leftHipX = poses[0].pose.keypoints[11].position.x\n      let leftHipY = poses[0].pose.keypoints[11].position.y\n      let rightHipX = poses[0].pose.keypoints[12].position.x\n      let rightHipY = poses[0].pose.keypoints[12].position.y\n      let leftKneeX = poses[0].pose.keypoints[13].position.x\n      let leftKneeY = poses[0].pose.keypoints[13].position.y\n      let rightKneeX = poses[0].pose.keypoints[14].position.x\n      let rightKneeY = poses[0].pose.keypoints[14].position.y\n      let leftAnkleX = poses[0].pose.keypoints[15].position.x\n      let leftAnkleY = poses[0].pose.keypoints[15].position.y\n      let rightAnkleX = poses[0].pose.keypoints[16].position.x\n      let rightAnkleY = poses[0].pose.keypoints[16].position.y\n\n      noseX = p.lerp(noseX, nX, 0.5)\n      noseY = p.lerp(noseY, nY, 0.5)\n      lShoulderX = p.lerp(lShoulderX, leftShoulderX, 0.5)\n      lShoulderY = p.lerp(lShoulderY, leftShoulderY, 0.5)\n      rShoulderX = p.lerp(rShoulderX, rightShoulderX, 0.5)\n      rShoulderY = p.lerp(rShoulderY, rightShoulderY, 0.5)\n      lElbowX = p.lerp(lElbowX, leftElbowX, 0.5)\n      lElbowY = p.lerp(lElbowY, leftElbowY, 0.5)\n      rElbowX = p.lerp(rElbowX, rightElbowX, 0.5)\n      rElbowY = p.lerp(rElbowY, rightElbowY, 0.5)\n      lWristX = p.lerp(lWristX, leftWristX, 0.5)\n      lWristY = p.lerp(lWristY, leftWristY, 0.5)\n      rWristX = p.lerp(rWristX, rightWristX, 0.5)\n      rWristY = p.lerp(rWristY, rightWristY, 0.5)\n      lHipX = p.lerp(lHipX, leftHipX, 0.5)\n      lHipY = p.lerp(lHipY, leftHipY, 0.5)\n      rHipX = p.lerp(rHipX, rightHipX, 0.5)\n      rHipY = p.lerp(rHipY, rightHipY, 0.5)\n      lKneeX = p.lerp(lKneeX, leftKneeX, 0.5)\n      lKneeY = p.lerp(lKneeY, leftKneeY, 0.5)\n      rKneeX = p.lerp(rKneeX, rightKneeX, 0.5)\n      rKneeY = p.lerp(rKneeY, rightKneeY, 0.5)\n      lAnkleX = p.lerp(lAnkleX, leftAnkleX, 0.5)\n      lAnkleY = p.lerp(lAnkleY, leftAnkleY, 0.5)\n      rAnkleX = p.lerp(rAnkleX, rightAnkleX, 0.5)\n      rAnkleY = p.lerp(rAnkleY, rightAnkleY, 0.5)\n\n      // 座標\n      // (leftShoulderX, leftShoulderY)\n      // (leftElbowX, leftElbowY)\n      // (leftWristX, leftWristY)\n\n      let lSE = new Array(2)\n      lSE[0] = leftShoulderX - leftElbowX\n      lSE[1] = leftShoulderY - leftShoulderY\n      let lWE = new Array(2)\n      lWE[0] = leftWristX - leftElbowX\n      lWE[1] = leftWristY - leftElbowY\n\n      let lSEWE = lSE[0] * lWE[0] + lSE[1] * lWE[1]\n      let lSEn = lSE[0] * lSE[0] + lSE[1] * lSE[1]\n      let lWEn = lWE[0] * lWE[0] + lWE[1] * lWE[1]\n      let radian = Math.acos(lSEWE / Math.sqrt(lSEn * lWEn))\n      let angle = (radian * 180) / Math.PI // 結果（ラジアンから角度に変換）\n\n      console.log(angle)\n      if (angle >= 100) {\n        should_count = true\n      } else if (angle <= 70 && should_count) {\n        count += 1\n        should_count = false\n      }\n    }\n  }\n\n  p.modelReady = () => {\n    // console.log('model ready')\n  }\n\n  // setup後に繰り返し実行される処理（フレーム単位）\n  p.draw = () => {\n    p.background(220)\n\n    // カメラからの映像は一旦getしてイメージとして扱う方が軽量\n    let img = video.get()\n    p.image(img, 0, 0, p.width, p.height)\n\n    p.fill(245, 222, 179)\n    p.ellipse(noseX, noseY, 20)\n    p.ellipse(lShoulderX, lShoulderY, 20)\n    p.ellipse(rShoulderX, rShoulderY, 20)\n    p.ellipse(lElbowX, lElbowY, 20)\n    p.ellipse(rElbowX, rElbowY, 20)\n    p.ellipse(lWristX, lWristY, 20)\n    p.ellipse(rWristX, rWristY, 20)\n    p.ellipse(lHipX, lHipY, 20)\n    p.ellipse(rHipX, rHipY, 20)\n    p.ellipse(lKneeX, lKneeY, 20)\n    p.ellipse(rKneeX, rKneeY, 20)\n    p.ellipse(lAnkleX, lAnkleY, 20)\n    p.ellipse(rAnkleX, rAnkleY, 20)\n\n    p.strokeWeight(5)\n    p.stroke(255, 127, 80)\n    p.line(lShoulderX, lShoulderY, rShoulderX, rShoulderY)\n    p.line(lShoulderX, lShoulderY, lElbowX, lElbowY)\n    p.line(lElbowX, lElbowY, lWristX, lWristY)\n    p.line(rShoulderX, rShoulderY, rElbowX, rElbowY)\n    p.line(rElbowX, rElbowY, rWristX, rWristY)\n    p.line(lShoulderX, lShoulderY, lHipX, lHipY)\n    p.line(lHipX, lHipY, lKneeX, lKneeY)\n    p.line(lKneeX, lKneeY, lAnkleX, lAnkleY)\n    p.line(rShoulderX, rShoulderY, rHipX, rHipY)\n    p.line(rHipX, rHipY, rKneeX, rKneeY)\n    p.line(rKneeX, rKneeY, rAnkleX, rAnkleY)\n    p.line(lHipX, lHipY, rHipX, rHipY)\n\n    // header\n    countCanvas.background(0, 0, 0, 0.8)\n    countCanvas.noStroke()\n    p.image(countCanvas, 0, 0, 400)\n\n    // count\n    p.fill(255, 127, 80)\n    p.text('count : ' + count, 50, 60)\n    p.textSize(60)\n  }\n}\n\nexport default PushUp\n"]},"metadata":{},"sourceType":"module"}