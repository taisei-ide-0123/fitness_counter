{"ast":null,"code":"var _jsxFileName = \"/Users/idetaisei/fitness_counter/client/src/sketches/ArmCurl.js\";\nimport React, { Component } from 'react';\nimport P5Wrapper from 'react-p5-wrapper';\nimport ml5 from 'ml5';\nimport axios from 'axios';\nimport PropTypes from 'prop-types';\nimport { connect } from 'react-redux';\nimport { setCurrentUser } from '../actions/authActions';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass ArmCurl extends Component {\n  constructor(props) {\n    super(props);\n    const {\n      user\n    } = this.props.auth; // console.log(user)\n\n    this.state = {\n      user: user.id,\n      event: 'arm curl',\n      count: '',\n      total_arm_curl_count: ''\n    }; // console.log(this.state)\n  }\n\n  componentDidMount() {\n    axios.get('/api/users/' + this.props.auth.user.id).then(response => {\n      this.setState({\n        total_arm_curl_count: response.data.total_arm_curl_count\n      }); // console.log(response.data)\n      // console.log(this.state.total_squat_count)\n    }).catch(error => {\n      console.log(error);\n    });\n  }\n\n  render() {\n    const arm_curl = p => {\n      let video;\n      let poseNet;\n      let saveButton;\n      let cancellButton;\n      let count = 0;\n      let countCanvas;\n      let should_count = true;\n      let noseX = 0;\n      let noseY = 0;\n      let lShoulderX = 0;\n      let lShoulderY = 0;\n      let rShoulderX = 0;\n      let rShoulderY = 0;\n      let lElbowX = 0;\n      let lElbowY = 0;\n      let rElbowX = 0;\n      let rElbowY = 0;\n      let lWristX = 0;\n      let lWristY = 0;\n      let rWristX = 0;\n      let rWristY = 0;\n      let lHipX = 0;\n      let lHipY = 0;\n      let rHipX = 0;\n      let rHipY = 0;\n      let lKneeX = 0;\n      let lKneeY = 0;\n      let rKneeX = 0;\n      let rKneeY = 0;\n      let lAnkleX = 0;\n      let lAnkleY = 0;\n      let rAnkleX = 0;\n      let rAnkleY = 0; // text(s, x, y, w, h)\n      // 最初の1回だけ実装される処理\n\n      p.setup = () => {\n        p.createCanvas(p.windowWidth, p.windowHeight);\n        countCanvas = p.createGraphics(p.windowWidth, p.windowHeight * 0.1);\n        video = p.createCapture(p.VIDEO);\n        video.size(p.windowWidth, p.windowHeight);\n        video.hide(); // 映像を一つにする\n\n        poseNet = ml5.poseNet(video, p.modelReady);\n        poseNet.on('pose', p.gotPoses); // ポーズが検出された時に結果を返すイベント\n\n        saveButton = p.createButton('save');\n        saveButton.position(p.windowWidth - 110, 5);\n        saveButton.mousePressed(p.save);\n        saveButton.style('width', '90px');\n        saveButton.style('height', '90px');\n        saveButton.style('color', '#fff');\n        saveButton.style('font-size', '25px');\n        saveButton.style('box-shadow', '2px 2px #000');\n        saveButton.style('border-radius', '50px');\n        saveButton.style('background', '#1da1f2');\n        saveButton.style('border', 'none');\n        cancellButton = p.createButton('cancell');\n        cancellButton.position(p.windowWidth - 220, 5);\n        cancellButton.mousePressed(p.cancell);\n        cancellButton.style('width', '90px');\n        cancellButton.style('height', '90px');\n        cancellButton.style('color', '#fff');\n        cancellButton.style('font-size', '25px');\n        cancellButton.style('box-shadow', '2px 2px #000');\n        cancellButton.style('border-radius', '50px');\n        cancellButton.style('background', '#ff0027');\n        cancellButton.style('border', 'none');\n      };\n\n      p.save = e => {\n        // console.log(count)\n        const current_count = {\n          user: this.state.user,\n          event: this.state.event,\n          count: count\n        }; // console.log(this.state.user)\n\n        const arm_curl_count = {\n          total_arm_curl_count: this.state.total_arm_curl_count + count\n        };\n        axios.post('/api/counts/add/' + this.state.user, current_count).then(res => console.log(res.data));\n        window.location = '/menu';\n      };\n\n      p.windowResized = () => {\n        p.resizeCanvas(p.windowWidth, p.windowHeight);\n      };\n\n      p.gotPoses = poses => {\n        // console.log(poses)\n        if (poses.length > 0) {\n          let nX = poses[0].pose.keypoints[0].position.x;\n          let nY = poses[0].pose.keypoints[0].position.y;\n          let leftShoulderX = poses[0].pose.keypoints[5].position.x;\n          let leftShoulderY = poses[0].pose.keypoints[5].position.y;\n          let rightShoulderX = poses[0].pose.keypoints[6].position.x;\n          let rightShoulderY = poses[0].pose.keypoints[6].position.y;\n          let leftElbowX = poses[0].pose.keypoints[7].position.x;\n          let leftElbowY = poses[0].pose.keypoints[7].position.y;\n          let rightElbowX = poses[0].pose.keypoints[8].position.x;\n          let rightElbowY = poses[0].pose.keypoints[8].position.y;\n          let leftWristX = poses[0].pose.keypoints[9].position.x;\n          let leftWristY = poses[0].pose.keypoints[9].position.y;\n          let rightWristX = poses[0].pose.keypoints[10].position.x;\n          let rightWristY = poses[0].pose.keypoints[10].position.y;\n          let leftHipX = poses[0].pose.keypoints[11].position.x;\n          let leftHipY = poses[0].pose.keypoints[11].position.y;\n          let rightHipX = poses[0].pose.keypoints[12].position.x;\n          let rightHipY = poses[0].pose.keypoints[12].position.y;\n          let leftKneeX = poses[0].pose.keypoints[13].position.x;\n          let leftKneeY = poses[0].pose.keypoints[13].position.y;\n          let rightKneeX = poses[0].pose.keypoints[14].position.x;\n          let rightKneeY = poses[0].pose.keypoints[14].position.y;\n          let leftAnkleX = poses[0].pose.keypoints[15].position.x;\n          let leftAnkleY = poses[0].pose.keypoints[15].position.y;\n          let rightAnkleX = poses[0].pose.keypoints[16].position.x;\n          let rightAnkleY = poses[0].pose.keypoints[16].position.y;\n          noseX = p.lerp(noseX, nX, 0.5);\n          noseY = p.lerp(noseY, nY, 0.5);\n          lShoulderX = p.lerp(lShoulderX, leftShoulderX, 0.5);\n          lShoulderY = p.lerp(lShoulderY, leftShoulderY, 0.5);\n          rShoulderX = p.lerp(rShoulderX, rightShoulderX, 0.5);\n          rShoulderY = p.lerp(rShoulderY, rightShoulderY, 0.5);\n          lElbowX = p.lerp(lElbowX, leftElbowX, 0.5);\n          lElbowY = p.lerp(lElbowY, leftElbowY, 0.5);\n          rElbowX = p.lerp(rElbowX, rightElbowX, 0.5);\n          rElbowY = p.lerp(rElbowY, rightElbowY, 0.5);\n          lWristX = p.lerp(lWristX, leftWristX, 0.5);\n          lWristY = p.lerp(lWristY, leftWristY, 0.5);\n          rWristX = p.lerp(rWristX, rightWristX, 0.5);\n          rWristY = p.lerp(rWristY, rightWristY, 0.5);\n          lHipX = p.lerp(lHipX, leftHipX, 0.5);\n          lHipY = p.lerp(lHipY, leftHipY, 0.5);\n          rHipX = p.lerp(rHipX, rightHipX, 0.5);\n          rHipY = p.lerp(rHipY, rightHipY, 0.5);\n          lKneeX = p.lerp(lKneeX, leftKneeX, 0.5);\n          lKneeY = p.lerp(lKneeY, leftKneeY, 0.5);\n          rKneeX = p.lerp(rKneeX, rightKneeX, 0.5);\n          rKneeY = p.lerp(rKneeY, rightKneeY, 0.5);\n          lAnkleX = p.lerp(lAnkleX, leftAnkleX, 0.5);\n          lAnkleY = p.lerp(lAnkleY, leftAnkleY, 0.5);\n          rAnkleX = p.lerp(rAnkleX, rightAnkleX, 0.5);\n          rAnkleY = p.lerp(rAnkleY, rightAnkleY, 0.5); // 座標\n          // (leftShoulderX, leftShoulderY)\n          // (leftElbowX, leftElbowY)\n          // (leftWristX, leftWristY)\n\n          let lSE = new Array(2);\n          lSE[0] = leftShoulderX - leftElbowX; // ba[0]\n\n          lSE[1] = leftShoulderY - leftElbowY; // ba[1]\n\n          let lWE = new Array(2);\n          lWE[0] = leftWristX - leftElbowX; // bc[0]\n\n          lWE[1] = leftWristY - leftElbowY; // bc[1]\n\n          let lSEWE = lSE[0] * lWE[0] + lSE[1] * lWE[1];\n          let lSEn = lSE[0] * lSE[0] + lSE[1] * lSE[1];\n          let lWEn = lWE[0] * lWE[0] + lWE[1] * lWE[1];\n          let l_radian = Math.acos(lSEWE / Math.sqrt(lSEn * lWEn));\n          let l_angle = l_radian * 180 / Math.PI; // 結果（ラジアンから角度に変換）\n          // 座標\n          // (rightShoulderX, rightShoulderY)\n          // (rightElbowX, rightElbowY)\n          // (rightWristX, rightWristY)\n\n          let rSE = new Array(2);\n          rSE[0] = rightShoulderX - rightElbowX; // ba[0]\n\n          rSE[1] = rightShoulderY - rightElbowY; // ba[1]\n\n          let rWE = new Array(2);\n          rWE[0] = rightWristX - rightElbowX; // bc[0]\n\n          rWE[1] = rightWristY - rightElbowY; // bc[1]\n\n          let rSEWE = rSE[0] * rWE[0] + rSE[1] * rWE[1];\n          let rSEn = rSE[0] * rSE[0] + rSE[1] * rSE[1];\n          let rWEn = rWE[0] * rWE[0] + rWE[1] * rWE[1];\n          let r_radian = Math.acos(rSEWE / Math.sqrt(rSEn * rWEn));\n          let r_angle = r_radian * 180 / Math.PI; // 結果（ラジアンから角度に変換）\n          // console.log(l_angle)\n          // console.log(r_angle)\n\n          if (l_angle >= 170 || r_angle >= 170) {\n            should_count = true;\n          } else if (l_angle <= 40 && should_count || r_angle <= 40 && should_count) {\n            count += 1;\n            should_count = false;\n          }\n        }\n      };\n\n      p.modelReady = () => {// console.log('model ready')\n      }; // setup後に繰り返し実行される処理（フレーム単位）\n\n\n      p.draw = () => {\n        p.background(220); // カメラからの映像は一旦getしてイメージとして扱う方が軽量\n\n        let img = video.get();\n        p.image(img, 0, 0, p.width, p.height);\n        p.fill(245, 222, 179);\n        p.ellipse(noseX, noseY, 20);\n        p.ellipse(lShoulderX, lShoulderY, 20);\n        p.ellipse(rShoulderX, rShoulderY, 20);\n        p.ellipse(lElbowX, lElbowY, 20);\n        p.ellipse(rElbowX, rElbowY, 20);\n        p.ellipse(lWristX, lWristY, 20);\n        p.ellipse(rWristX, rWristY, 20);\n        p.ellipse(lHipX, lHipY, 20);\n        p.ellipse(rHipX, rHipY, 20);\n        p.ellipse(lKneeX, lKneeY, 20);\n        p.ellipse(rKneeX, rKneeY, 20);\n        p.ellipse(lAnkleX, lAnkleY, 20);\n        p.ellipse(rAnkleX, rAnkleY, 20);\n        p.strokeWeight(5);\n        p.stroke(255, 127, 80);\n        p.line(lShoulderX, lShoulderY, rShoulderX, rShoulderY);\n        p.line(lShoulderX, lShoulderY, lElbowX, lElbowY);\n        p.line(lElbowX, lElbowY, lWristX, lWristY);\n        p.line(rShoulderX, rShoulderY, rElbowX, rElbowY);\n        p.line(rElbowX, rElbowY, rWristX, rWristY);\n        p.line(lShoulderX, lShoulderY, lHipX, lHipY);\n        p.line(lHipX, lHipY, lKneeX, lKneeY);\n        p.line(lKneeX, lKneeY, lAnkleX, lAnkleY);\n        p.line(rShoulderX, rShoulderY, rHipX, rHipY);\n        p.line(rHipX, rHipY, rKneeX, rKneeY);\n        p.line(rKneeX, rKneeY, rAnkleX, rAnkleY);\n        p.line(lHipX, lHipY, rHipX, rHipY); // header\n\n        countCanvas.background(0, 0, 0, 0.8);\n        countCanvas.noStroke();\n        p.image(countCanvas, 0, 0, 400); // count\n\n        p.fill(255, 127, 80);\n        p.text('count : ' + count, 50, 60);\n        p.textSize(60);\n      };\n    };\n\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(P5Wrapper, {\n        sketch: arm_curl\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 297,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 296,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nArmCurl.propTypes = {\n  setCurrentUser: PropTypes.func.isRequired,\n  auth: PropTypes.object.isRequired\n};\n\nconst mapStateToProps = state => ({\n  auth: state.auth\n});\n\nexport default connect(mapStateToProps, {\n  setCurrentUser\n})(ArmCurl);","map":{"version":3,"sources":["/Users/idetaisei/fitness_counter/client/src/sketches/ArmCurl.js"],"names":["React","Component","P5Wrapper","ml5","axios","PropTypes","connect","setCurrentUser","ArmCurl","constructor","props","user","auth","state","id","event","count","total_arm_curl_count","componentDidMount","get","then","response","setState","data","catch","error","console","log","render","arm_curl","p","video","poseNet","saveButton","cancellButton","countCanvas","should_count","noseX","noseY","lShoulderX","lShoulderY","rShoulderX","rShoulderY","lElbowX","lElbowY","rElbowX","rElbowY","lWristX","lWristY","rWristX","rWristY","lHipX","lHipY","rHipX","rHipY","lKneeX","lKneeY","rKneeX","rKneeY","lAnkleX","lAnkleY","rAnkleX","rAnkleY","setup","createCanvas","windowWidth","windowHeight","createGraphics","createCapture","VIDEO","size","hide","modelReady","on","gotPoses","createButton","position","mousePressed","save","style","cancell","e","current_count","arm_curl_count","post","res","window","location","windowResized","resizeCanvas","poses","length","nX","pose","keypoints","x","nY","y","leftShoulderX","leftShoulderY","rightShoulderX","rightShoulderY","leftElbowX","leftElbowY","rightElbowX","rightElbowY","leftWristX","leftWristY","rightWristX","rightWristY","leftHipX","leftHipY","rightHipX","rightHipY","leftKneeX","leftKneeY","rightKneeX","rightKneeY","leftAnkleX","leftAnkleY","rightAnkleX","rightAnkleY","lerp","lSE","Array","lWE","lSEWE","lSEn","lWEn","l_radian","Math","acos","sqrt","l_angle","PI","rSE","rWE","rSEWE","rSEn","rWEn","r_radian","r_angle","draw","background","img","image","width","height","fill","ellipse","strokeWeight","stroke","line","noStroke","text","textSize","propTypes","func","isRequired","object","mapStateToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport P5Wrapper from 'react-p5-wrapper'\nimport ml5 from 'ml5'\nimport axios from 'axios'\nimport PropTypes from 'prop-types'\nimport { connect } from 'react-redux'\nimport { setCurrentUser } from '../actions/authActions'\n\nclass ArmCurl extends Component {\n  constructor(props) {\n    super(props)\n    const { user } = this.props.auth\n    // console.log(user)\n    this.state = {\n      user: user.id,\n      event: 'arm curl',\n      count: '',\n      total_arm_curl_count: '',\n    }\n    // console.log(this.state)\n  }\n\n  componentDidMount() {\n    axios\n      .get('/api/users/' + this.props.auth.user.id)\n      .then((response) => {\n        this.setState({\n          total_arm_curl_count: response.data.total_arm_curl_count,\n        })\n        // console.log(response.data)\n        // console.log(this.state.total_squat_count)\n      })\n      .catch((error) => {\n        console.log(error)\n      })\n  }\n\n  render() {\n    const arm_curl = (p) => {\n      let video\n      let poseNet\n      let saveButton\n      let cancellButton\n      let count = 0\n      let countCanvas\n      let should_count = true\n      let noseX = 0\n      let noseY = 0\n      let lShoulderX = 0\n      let lShoulderY = 0\n      let rShoulderX = 0\n      let rShoulderY = 0\n      let lElbowX = 0\n      let lElbowY = 0\n      let rElbowX = 0\n      let rElbowY = 0\n      let lWristX = 0\n      let lWristY = 0\n      let rWristX = 0\n      let rWristY = 0\n      let lHipX = 0\n      let lHipY = 0\n      let rHipX = 0\n      let rHipY = 0\n      let lKneeX = 0\n      let lKneeY = 0\n      let rKneeX = 0\n      let rKneeY = 0\n      let lAnkleX = 0\n      let lAnkleY = 0\n      let rAnkleX = 0\n      let rAnkleY = 0\n\n      // text(s, x, y, w, h)\n\n      // 最初の1回だけ実装される処理\n      p.setup = () => {\n        p.createCanvas(p.windowWidth, p.windowHeight)\n        countCanvas = p.createGraphics(p.windowWidth, p.windowHeight * 0.1)\n        video = p.createCapture(p.VIDEO)\n        video.size(p.windowWidth, p.windowHeight)\n        video.hide() // 映像を一つにする\n        poseNet = ml5.poseNet(video, p.modelReady)\n        poseNet.on('pose', p.gotPoses) // ポーズが検出された時に結果を返すイベント\n\n        saveButton = p.createButton('save')\n        saveButton.position(p.windowWidth - 110, 5)\n        saveButton.mousePressed(p.save)\n        saveButton.style('width', '90px')\n        saveButton.style('height', '90px')\n        saveButton.style('color', '#fff')\n        saveButton.style('font-size', '25px')\n        saveButton.style('box-shadow', '2px 2px #000')\n        saveButton.style('border-radius', '50px')\n        saveButton.style('background', '#1da1f2')\n        saveButton.style('border', 'none')\n\n        cancellButton = p.createButton('cancell')\n        cancellButton.position(p.windowWidth - 220, 5)\n        cancellButton.mousePressed(p.cancell)\n        cancellButton.style('width', '90px')\n        cancellButton.style('height', '90px')\n        cancellButton.style('color', '#fff')\n        cancellButton.style('font-size', '25px')\n        cancellButton.style('box-shadow', '2px 2px #000')\n        cancellButton.style('border-radius', '50px')\n        cancellButton.style('background', '#ff0027')\n        cancellButton.style('border', 'none')\n      }\n\n      p.save = (e) => {\n        // console.log(count)\n        const current_count = {\n          user: this.state.user,\n          event: this.state.event,\n          count: count,\n        }\n        // console.log(this.state.user)\n        const arm_curl_count = {\n          total_arm_curl_count: this.state.total_arm_curl_count + count,\n        }\n\n        axios\n          .post('/api/counts/add/' + this.state.user, current_count)\n          .then((res) => console.log(res.data))\n\n        window.location = '/menu'\n      }\n\n      p.windowResized = () => {\n        p.resizeCanvas(p.windowWidth, p.windowHeight)\n      }\n\n      p.gotPoses = (poses) => {\n        // console.log(poses)\n        if (poses.length > 0) {\n          let nX = poses[0].pose.keypoints[0].position.x\n          let nY = poses[0].pose.keypoints[0].position.y\n          let leftShoulderX = poses[0].pose.keypoints[5].position.x\n          let leftShoulderY = poses[0].pose.keypoints[5].position.y\n          let rightShoulderX = poses[0].pose.keypoints[6].position.x\n          let rightShoulderY = poses[0].pose.keypoints[6].position.y\n          let leftElbowX = poses[0].pose.keypoints[7].position.x\n          let leftElbowY = poses[0].pose.keypoints[7].position.y\n          let rightElbowX = poses[0].pose.keypoints[8].position.x\n          let rightElbowY = poses[0].pose.keypoints[8].position.y\n          let leftWristX = poses[0].pose.keypoints[9].position.x\n          let leftWristY = poses[0].pose.keypoints[9].position.y\n          let rightWristX = poses[0].pose.keypoints[10].position.x\n          let rightWristY = poses[0].pose.keypoints[10].position.y\n          let leftHipX = poses[0].pose.keypoints[11].position.x\n          let leftHipY = poses[0].pose.keypoints[11].position.y\n          let rightHipX = poses[0].pose.keypoints[12].position.x\n          let rightHipY = poses[0].pose.keypoints[12].position.y\n          let leftKneeX = poses[0].pose.keypoints[13].position.x\n          let leftKneeY = poses[0].pose.keypoints[13].position.y\n          let rightKneeX = poses[0].pose.keypoints[14].position.x\n          let rightKneeY = poses[0].pose.keypoints[14].position.y\n          let leftAnkleX = poses[0].pose.keypoints[15].position.x\n          let leftAnkleY = poses[0].pose.keypoints[15].position.y\n          let rightAnkleX = poses[0].pose.keypoints[16].position.x\n          let rightAnkleY = poses[0].pose.keypoints[16].position.y\n\n          noseX = p.lerp(noseX, nX, 0.5)\n          noseY = p.lerp(noseY, nY, 0.5)\n          lShoulderX = p.lerp(lShoulderX, leftShoulderX, 0.5)\n          lShoulderY = p.lerp(lShoulderY, leftShoulderY, 0.5)\n          rShoulderX = p.lerp(rShoulderX, rightShoulderX, 0.5)\n          rShoulderY = p.lerp(rShoulderY, rightShoulderY, 0.5)\n          lElbowX = p.lerp(lElbowX, leftElbowX, 0.5)\n          lElbowY = p.lerp(lElbowY, leftElbowY, 0.5)\n          rElbowX = p.lerp(rElbowX, rightElbowX, 0.5)\n          rElbowY = p.lerp(rElbowY, rightElbowY, 0.5)\n          lWristX = p.lerp(lWristX, leftWristX, 0.5)\n          lWristY = p.lerp(lWristY, leftWristY, 0.5)\n          rWristX = p.lerp(rWristX, rightWristX, 0.5)\n          rWristY = p.lerp(rWristY, rightWristY, 0.5)\n          lHipX = p.lerp(lHipX, leftHipX, 0.5)\n          lHipY = p.lerp(lHipY, leftHipY, 0.5)\n          rHipX = p.lerp(rHipX, rightHipX, 0.5)\n          rHipY = p.lerp(rHipY, rightHipY, 0.5)\n          lKneeX = p.lerp(lKneeX, leftKneeX, 0.5)\n          lKneeY = p.lerp(lKneeY, leftKneeY, 0.5)\n          rKneeX = p.lerp(rKneeX, rightKneeX, 0.5)\n          rKneeY = p.lerp(rKneeY, rightKneeY, 0.5)\n          lAnkleX = p.lerp(lAnkleX, leftAnkleX, 0.5)\n          lAnkleY = p.lerp(lAnkleY, leftAnkleY, 0.5)\n          rAnkleX = p.lerp(rAnkleX, rightAnkleX, 0.5)\n          rAnkleY = p.lerp(rAnkleY, rightAnkleY, 0.5)\n\n          // 座標\n          // (leftShoulderX, leftShoulderY)\n          // (leftElbowX, leftElbowY)\n          // (leftWristX, leftWristY)\n\n          let lSE = new Array(2)\n          lSE[0] = leftShoulderX - leftElbowX // ba[0]\n          lSE[1] = leftShoulderY - leftElbowY // ba[1]\n          let lWE = new Array(2)\n          lWE[0] = leftWristX - leftElbowX // bc[0]\n          lWE[1] = leftWristY - leftElbowY // bc[1]\n\n          let lSEWE = lSE[0] * lWE[0] + lSE[1] * lWE[1]\n          let lSEn = lSE[0] * lSE[0] + lSE[1] * lSE[1]\n          let lWEn = lWE[0] * lWE[0] + lWE[1] * lWE[1]\n          let l_radian = Math.acos(lSEWE / Math.sqrt(lSEn * lWEn))\n          let l_angle = (l_radian * 180) / Math.PI // 結果（ラジアンから角度に変換）\n\n          // 座標\n          // (rightShoulderX, rightShoulderY)\n          // (rightElbowX, rightElbowY)\n          // (rightWristX, rightWristY)\n\n          let rSE = new Array(2)\n          rSE[0] = rightShoulderX - rightElbowX // ba[0]\n          rSE[1] = rightShoulderY - rightElbowY // ba[1]\n          let rWE = new Array(2)\n          rWE[0] = rightWristX - rightElbowX // bc[0]\n          rWE[1] = rightWristY - rightElbowY // bc[1]\n\n          let rSEWE = rSE[0] * rWE[0] + rSE[1] * rWE[1]\n          let rSEn = rSE[0] * rSE[0] + rSE[1] * rSE[1]\n          let rWEn = rWE[0] * rWE[0] + rWE[1] * rWE[1]\n          let r_radian = Math.acos(rSEWE / Math.sqrt(rSEn * rWEn))\n          let r_angle = (r_radian * 180) / Math.PI // 結果（ラジアンから角度に変換）\n\n          // console.log(l_angle)\n          // console.log(r_angle)\n          if (l_angle >= 170 || r_angle >= 170) {\n            should_count = true\n          } else if (\n            (l_angle <= 40 && should_count) ||\n            (r_angle <= 40 && should_count)\n          ) {\n            count += 1\n            should_count = false\n          }\n        }\n      }\n\n      p.modelReady = () => {\n        // console.log('model ready')\n      }\n\n      // setup後に繰り返し実行される処理（フレーム単位）\n      p.draw = () => {\n        p.background(220)\n\n        // カメラからの映像は一旦getしてイメージとして扱う方が軽量\n        let img = video.get()\n        p.image(img, 0, 0, p.width, p.height)\n\n        p.fill(245, 222, 179)\n        p.ellipse(noseX, noseY, 20)\n        p.ellipse(lShoulderX, lShoulderY, 20)\n        p.ellipse(rShoulderX, rShoulderY, 20)\n        p.ellipse(lElbowX, lElbowY, 20)\n        p.ellipse(rElbowX, rElbowY, 20)\n        p.ellipse(lWristX, lWristY, 20)\n        p.ellipse(rWristX, rWristY, 20)\n        p.ellipse(lHipX, lHipY, 20)\n        p.ellipse(rHipX, rHipY, 20)\n        p.ellipse(lKneeX, lKneeY, 20)\n        p.ellipse(rKneeX, rKneeY, 20)\n        p.ellipse(lAnkleX, lAnkleY, 20)\n        p.ellipse(rAnkleX, rAnkleY, 20)\n\n        p.strokeWeight(5)\n        p.stroke(255, 127, 80)\n        p.line(lShoulderX, lShoulderY, rShoulderX, rShoulderY)\n        p.line(lShoulderX, lShoulderY, lElbowX, lElbowY)\n        p.line(lElbowX, lElbowY, lWristX, lWristY)\n        p.line(rShoulderX, rShoulderY, rElbowX, rElbowY)\n        p.line(rElbowX, rElbowY, rWristX, rWristY)\n        p.line(lShoulderX, lShoulderY, lHipX, lHipY)\n        p.line(lHipX, lHipY, lKneeX, lKneeY)\n        p.line(lKneeX, lKneeY, lAnkleX, lAnkleY)\n        p.line(rShoulderX, rShoulderY, rHipX, rHipY)\n        p.line(rHipX, rHipY, rKneeX, rKneeY)\n        p.line(rKneeX, rKneeY, rAnkleX, rAnkleY)\n        p.line(lHipX, lHipY, rHipX, rHipY)\n\n        // header\n        countCanvas.background(0, 0, 0, 0.8)\n        countCanvas.noStroke()\n        p.image(countCanvas, 0, 0, 400)\n\n        // count\n        p.fill(255, 127, 80)\n        p.text('count : ' + count, 50, 60)\n        p.textSize(60)\n      }\n    }\n\n    return (\n      <div>\n        <P5Wrapper sketch={arm_curl} />\n      </div>\n    )\n  }\n}\n\nArmCurl.propTypes = {\n  setCurrentUser: PropTypes.func.isRequired,\n  auth: PropTypes.object.isRequired,\n}\n\nconst mapStateToProps = (state) => ({\n  auth: state.auth,\n})\n\nexport default connect(mapStateToProps, { setCurrentUser })(ArmCurl)\n"]},"metadata":{},"sourceType":"module"}